<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C√îNG C·ª§ T·∫†O ƒê∆†N KH·ªûI KI·ªÜN H√ÄNG LO·∫†T</title>
    <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Times New Roman", serif;
        }
        
        body {
            background: #f5f5f5;
            padding: 20px;
            line-height: 1.5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        
        .header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .main-content {
            display: flex;
            min-height: 800px;
        }
        
        .input-panel {
            flex: 1;
            background: #f8f9fa;
            padding: 20px;
            border-right: 1px solid #ddd;
            overflow-y: auto;
            max-height: 800px;
        }
        
        .preview-panel {
            flex: 1;
            padding: 20px;
            background: white;
            overflow-y: auto;
        }
        
        .section {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .section-title {
            font-weight: bold;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #3498db;
            color: #2c3e50;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            font-family: "Times New Roman", serif;
        }
        
        .form-group textarea {
            height: 80px;
            resize: vertical;
        }
        
        .debt-table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
            font-size: 14px;
        }
        
        .debt-table td {
            border: 1px solid #000;
            padding: 8px 12px;
        }
        
        .debt-table input {
            border: none;
            background: transparent;
            width: 100%;
            font-family: "Times New Roman", serif;
        }
        
        .contract-section {
            background: #e8f4fc;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid #3498db;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            margin: 5px;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: #3498db;
            color: white;
        }
        
        .btn-success {
            background: #27ae60;
            color: white;
        }
        
        .btn-danger {
            background: #e74c3c;
            color: white;
        }
        
        .btn-warning {
            background: #f39c12;
            color: white;
        }
        
        .btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }
        
        .action-buttons {
            text-align: center;
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        
        .document-preview {
            background: white;
            padding: 30px;
            border: 1px solid #ddd;
            min-height: 800px;
            font-family: "Times New Roman", serif;
            line-height: 1.6;
        }
        
        .preview-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        
        .preview-table td {
            border: 1px solid #000;
            padding: 8px 12px;
        }
        
        .upload-area {
            border: 2px dashed #3498db;
            padding: 30px;
            text-align: center;
            margin: 20px 0;
            border-radius: 5px;
            background: #f8f9fa;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .upload-area:hover {
            background: #e8f4fc;
            border-color: #2980b9;
        }
        
        .upload-area i {
            font-size: 48px;
            color: #3498db;
            margin-bottom: 15px;
        }
        
        .tab-container {
            margin: 20px 0;
        }
        
        .tabs {
            display: flex;
            border-bottom: 2px solid #3498db;
        }
        
        .tab {
            padding: 12px 24px;
            background: #ecf0f1;
            border: 1px solid #bdc3c7;
            border-bottom: none;
            cursor: pointer;
            margin-right: 5px;
            border-radius: 5px 5px 0 0;
        }
        
        .tab.active {
            background: #3498db;
            color: white;
            border-color: #2980b9;
        }
        
        .tab-content {
            display: none;
            padding: 20px;
            border: 1px solid #ddd;
            border-top: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .customer-count {
            text-align: center;
            padding: 10px;
            background: #2c3e50;
            color: white;
            margin: 10px 0;
            border-radius: 5px;
        }
        
        .hidden {
            display: none;
        }
        
        .signature-section {
            text-align: right;
            margin-top: 100px;
            font-style: italic;
        }
        
        .customer-item {
            background: #fff;
            border: 1px solid #ddd;
            margin: 10px 0;
            padding: 15px;
            border-radius: 5px;
        }
        
        .customer-header {
            background: #34495e;
            color: white;
            padding: 10px;
            margin: -15px -15px 10px -15px;
            border-radius: 3px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .remove-customer {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
        }
        
        .file-info {
            background: #d4edda;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            border-left: 4px solid #28a745;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #f0f0f0;
            border-radius: 10px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background: #27ae60;
            width: 0%;
            transition: width 0.3s;
        }
        
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .input-panel {
                border-right: none;
                border-bottom: 1px solid #ddd;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>C√îNG C·ª§ T·∫†O ƒê∆†N KH·ªûI KI·ªÜN H√ÄNG LO·∫†T</h1>
            <p>Nh·∫≠p th√¥ng tin m·ªôt l·∫ßn - T·∫°o ƒë∆°n cho nhi·ªÅu kh√°ch h√†ng</p>
        </div>
        
        <div class="main-content">
            <!-- Panel nh·∫≠p li·ªáu -->
            <div class="input-panel">
                <div class="tab-container">
                    <div class="tabs">
                        <div class="tab active" onclick="switchTab(1)">NH·∫¨P TH√îNG TIN</div>
                        <div class="tab" onclick="switchTab(2)">UPLOAD FILE</div>
                        <div class="tab" onclick="switchTab(3)">D√ÅN D·ªÆ LI·ªÜU</div>
                    </div>
                    
                    <!-- Tab 1: Nh·∫≠p th√¥ng tin -->
                    <div id="tab1" class="tab-content active">
                        <div class="section">
                            <div class="section-title">THI·∫æT L·∫¨P M·∫™U CHUNG</div>
                            
                            <div class="form-group">
                                <label>T√™n T√≤a √°n:</label>
                                <input type="text" id="courtName" value="T√íA √ÅN NH√ÇN D√ÇN KHU V·ª∞C 8, TH√ÄNH PH·ªê H·ªí CH√ç MINH">
                            </div>
                            
                            <div class="form-group">
                                <label>Ng√†y l·∫≠p ƒë∆°n:</label>
                                <input type="text" id="currentDate" value="Th√†nh ph·ªë H·ªì Ch√≠ Minh, ng√†y 22 th√°ng 11 nƒÉm 2025">
                            </div>
                        </div>
                        
                        <div class="section">
                            <div class="section-title">TH√îNG TIN NG√ÇN H√ÄNG</div>
                            
                            <div class="form-group">
                                <label>T√™n ng√¢n h√†ng:</label>
                                <input type="text" id="plaintiffName" value="Ng√¢n h√†ng TMCP Vi·ªát Nam Th·ªãnh V∆∞·ª£ng (VPBank)">
                            </div>
                            
                            <div class="form-group">
                                <label>ƒê·ªãa ch·ªâ tr·ª• s·ªü:</label>
                                <input type="text" id="plaintiffAddress" value="S·ªë 89 L√°ng H·∫°, ph∆∞·ªùng ƒê·ªëng ƒêa, Tp. H√† N·ªôi">
                            </div>
                            
                            <div class="form-group">
                                <label>ƒê·ªãa ch·ªâ li√™n l·∫°c:</label>
                                <input type="text" id="plaintiffContact" value="T·∫ßng 1, s·ªë 96 Cao Th·∫Øng, ph∆∞·ªùng B√†n C·ªù, Tp. H·ªì Ch√≠ Minh">
                            </div>
                            
                            <div class="form-group">
                                <label>Ng∆∞·ªùi ƒë·∫°i di·ªán theo ph√°p lu·∫≠t:</label>
                                <input type="text" id="legalRepresentative" value="√îng Ng√¥ Ch√≠ D≈©ng - Ch·ªß t·ªãch H·ªôi ƒë·ªìng qu·∫£n tr·ªã">
                            </div>
                            
                            <div class="form-group">
                                <label>Ng∆∞·ªùi ƒë·∫°i di·ªán theo ·ªßy quy·ªÅn:</label>
                                <input type="text" id="authorizedRepresentative" value="√îng ƒê·ªó Th√†nh Trung - Ch·ª©c v·ª•: Ph√≥ Gi√°m ƒë·ªëc Trung t√¢m THN KHDN & XLN ph√°p l√Ω">
                            </div>
                            
                            <div class="form-group">
                                <label>VƒÉn b·∫£n ·ªßy quy·ªÅn:</label>
                                <input type="text" id="authorizationDoc" value="VƒÉn b·∫£n ·ªßy quy·ªÅn s·ªë 50/2025/UQN-CTQT ng√†y 07/11/2025 c·ªßa Ch·ªß t·ªãch H·ªôi ƒë·ªìng qu·∫£n tr·ªã Ng√¢n h√†ng TMCP Vi·ªát Nam Th·ªãnh V∆∞·ª£ng - VPBank">
                            </div>
                        </div>
                        
                        <div class="section">
                            <div class="section-title">M·∫™U H·ª¢P ƒê·ªíNG VAY</div>
                            <div id="contractsContainer">
                                <!-- Contracts will be added here -->
                            </div>
                            <div style="text-align: center;">
                                <button class="btn btn-primary" onclick="addContract()">+ Th√™m h·ª£p ƒë·ªìng</button>
                                <button class="btn btn-danger" onclick="removeContract()">- X√≥a h·ª£p ƒë·ªìng</button>
                            </div>
                        </div>
                        
                        <div class="section">
                            <div class="section-title">TH√îNG TIN VI PH·∫†M</div>
                            
                            <div class="form-group">
                                <label>Ng√†y b·∫Øt ƒë·∫ßu vi ph·∫°m:</label>
                                <input type="text" id="violationDate" value="10/05/2023">
                            </div>
                            
                            <div class="form-group">
                                <label>M√¥ t·∫£ vi ph·∫°m:</label>
                                <textarea id="violationDescription">Trong qu√° tr√¨nh s·ª≠ d·ª•ng v·ªën vay c·ªßa nh∆∞ÃÉng H·ª£p ƒë·ªìng cho vay tr√™n, kh√°ch h√†ng ƒë√£ qu√° h·∫°n thanh to√°n n·ª£ g·ªëc v√† l√£i vay cho VPBank. M·∫∑c d√π, Ng√¢n h√†ng ƒë√£ t·∫°o ƒëi·ªÅu ki·ªán v·ªÅ th·ªùi gian cho kh√°ch h√†ng tr·∫£ n·ª£ nh∆∞ng ph√≠a kh√°ch h√†ng v·∫´n kh√¥ng c√≥ ph∆∞∆°ng √°n tr·∫£ d·ª©t n·ª£ cho ng√¢n h√†ng.

X√©t th·∫•y b√™n vay kh√¥ng c√≤n kh·∫£ nƒÉng thanh to√°n n·ª£, do ƒë√≥ VPBank ƒë√£ chuy·ªÉn to√†n b·ªô kho·∫£n vay sang n·ª£ qu√° h·∫°n v√† th√¥ng b√°o ch·∫•m d·ª©t vi·ªác th·ª±c hi·ªán ƒë·ªëi v·ªõi h·ª£p ƒë·ªìng cho vay tr√™n, ƒë·ªìng th·ªùi ti·∫øn h√†nh kh·ªüi ki·ªán ƒë∆∞∆°ng s·ª± t·∫°i To√† √°n nh√¢n d√¢n c√≥ th·∫©m quy·ªÅn ƒë·ªÉ gi·∫£i quy·∫øt.</textarea>
                            </div>
                        </div>
                        
                        <div class="section">
                            <div class="section-title">DANH S√ÅCH KH√ÅCH H√ÄNG</div>
                            <div class="customer-count" id="customerCount">S·ªë l∆∞·ª£ng kh√°ch h√†ng: 1</div>
                            <div id="customersContainer">
                                <!-- Customer forms will be added here -->
                            </div>
                            <div style="text-align: center;">
                                <button class="btn btn-success" onclick="addCustomer()">+ Th√™m kh√°ch h√†ng</button>
                                <button class="btn btn-danger" onclick="removeCustomer()">- X√≥a kh√°ch h√†ng</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Tab 2: Upload file -->
                    <div id="tab2" class="tab-content">
                        <div class="upload-area" id="uploadArea" onclick="document.getElementById('fileUpload').click()">
                            <div>üìÅ</div>
                            <h3>UPLOAD FILE EXCEL</h3>
                            <p>K√©o th·∫£ file v√†o ƒë√¢y ho·∫∑c click ƒë·ªÉ ch·ªçn file</p>
                            <input type="file" id="fileUpload" accept=".xlsx,.xls,.csv" style="display: none;" onchange="handleFileUpload(this.files[0])">
                            <p style="margin-top: 15px; font-size: 12px; color: #666;">
                                H·ªó tr·ª£: Excel (.xlsx, .xls), CSV (.csv)
                            </p>
                        </div>
                        
                        <div id="fileInfo" class="file-info hidden">
                            <strong>File ƒë√£ ch·ªçn:</strong> <span id="fileName"></span>
                            <br>
                            <strong>S·ªë d√≤ng d·ªØ li·ªáu:</strong> <span id="rowCount"></span>
                            <button class="btn btn-success" onclick="processUploadedData()" style="margin-top: 10px;">X·ª¨ L√ù D·ªÆ LI·ªÜU</button>
                        </div>

                        <div class="progress-bar hidden" id="progressBar">
                            <div class="progress" id="progress"></div>
                        </div>
                        
                        <div class="section">
                            <div class="section-title">H∆Ø·ªöNG D·∫™N UPLOAD</div>
                            <p><strong>ƒê·ªãnh d·∫°ng file Excel m·∫´u:</strong></p>
                            <ul style="padding-left: 20px; margin: 10px 0;">
                                <li>Column A: H·ªç t√™n</li>
                                <li>Column B: NƒÉm sinh</li>
                                <li>Column C: CMND/CCCD</li>
                                <li>Column D: Ng√†y c·∫•p</li>
                                <li>Column E: N∆°i c·∫•p</li>
                                <li>Column F: ƒê·ªãa ch·ªâ</li>
                                <li>Column G: S·ªë ƒëi·ªán tho·∫°i</li>
                            </ul>
                            <button class="btn btn-warning" onclick="downloadTemplate()">T·∫¢I FILE M·∫™U</button>
                        </div>
                    </div>
                    
                    <!-- Tab 3: D√°n d·ªØ li·ªáu -->
                    <div id="tab3" class="tab-content">
                        <div class="section">
                            <div class="section-title">D√ÅN D·ªÆ LI·ªÜU T·ª™ EXCEL</div>
                            
                            <div class="form-group">
                                <label>D√°n d·ªØ li·ªáu (copy t·ª´ Excel):</label>
                                <textarea id="pasteData" placeholder="D√°n d·ªØ li·ªáu t·ª´ Excel v√†o ƒë√¢y...&#10;M·ªói d√≤ng l√† m·ªôt kh√°ch h√†ng, c√°c c·ªôt c√°ch nhau b·∫±ng tab&#10;&#10;V√≠ d·ª•:&#10;Phan Nh·∫≠t Linh	1996	079096006806	22/11/2021	C·ª•c C·∫£nh s√°t v·ªÅ QLHC v√† TTXH	158/5A ·∫•p Th·ªõi T√¢y 2, X√£ H√≥c M√¥n	0901350113&#10;Nguy·ªÖn VƒÉn A	1985	012345678901	15/08/2020	C√¥ng an TP H√† N·ªôi	123 ƒê∆∞·ªùng ABC, Qu·∫≠n 1, TP HCM	0912345678" style="height: 200px;"></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label>Ho·∫∑c nh·∫≠p danh s√°ch (m·ªói d√≤ng m·ªôt kh√°ch h√†ng):</label>
                                <textarea id="textData" placeholder="Nh·∫≠p danh s√°ch kh√°ch h√†ng...&#10;M·ªói d√≤ng m·ªôt kh√°ch h√†ng v·ªõi ƒë·ªãnh d·∫°ng:&#10;H·ªç t√™n | NƒÉm sinh | CMND | Ng√†y c·∫•p | N∆°i c·∫•p | ƒê·ªãa ch·ªâ | S·ªë ƒêT&#10;&#10;V√≠ d·ª•:&#10;Phan Nh·∫≠t Linh | 1996 | 079096006806 | 22/11/2021 | C·ª•c C·∫£nh s√°t v·ªÅ QLHC v√† TTXH | 158/5A ·∫•p Th·ªõi T√¢y 2, X√£ H√≥c M√¥n | 0901350113" style="height: 200px;"></textarea>
                            </div>
                            
                            <button class="btn btn-success" onclick="processPastedData()">X·ª¨ L√ù D·ªÆ LI·ªÜU</button>
                        </div>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-success" onclick="generateAllDocuments()">T·∫†O ƒê∆†N H√ÄNG LO·∫†T</button>
                    <button class="btn btn-primary" onclick="previewDocument()">XEM TR∆Ø·ªöC</button>
                    <button class="btn btn-warning" onclick="resetForm()">NH·∫¨P L·∫†I</button>
                </div>
            </div>
            
            <!-- Panel xem tr∆∞·ªõc -->
            <div class="preview-panel">
                <div class="section">
                    <div class="section-title">XEM TR∆Ø·ªöC ƒê∆†N KH·ªûI KI·ªÜN</div>
                    <div class="document-preview" id="documentPreview">
                        <div style="text-align: center; color: #666; padding: 100px 20px;">
                            <div style="font-size: 48px; margin-bottom: 20px;">üìÑ</div>
                            <h3>CH∆ØA C√ì D·ªÆ LI·ªÜU</h3>
                            <p>Nh·∫≠p th√¥ng tin v√† click "XEM TR∆Ø·ªöC" ƒë·ªÉ hi·ªÉn th·ªã ƒë∆°n t·∫°i ƒë√¢y</p>
                        </div>
                    </div>
                    
                    <div class="action-buttons">
                        <button class="btn btn-success" onclick="downloadAllDocuments()">T·∫¢I T·∫§T C·∫¢ (.ZIP)</button>
                        <button class="btn btn-primary" onclick="printDocument()">IN ƒê∆†N</button>
                        <button class="btn btn-warning" onclick="downloadSummary()">B√ÅO C√ÅO T·ªîNG H·ª¢P</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Bi·∫øn to√†n c·ª•c
        let customerCount = 1;
        let contractCount = 0;
        let customers = [];
        let uploadedData = [];
        
        // Kh·ªüi t·∫°o khi trang load
        document.addEventListener('DOMContentLoaded', function() {
            initializeContracts();
            initializeCustomers();
            setupEventListeners();
        });
        
        // Chuy·ªÉn tab
        function switchTab(tabNumber) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            document.querySelectorAll('.tab')[tabNumber - 1].classList.add('active');
            document.getElementById(`tab${tabNumber}`).classList.add('active');
        }
        
        // Kh·ªüi t·∫°o h·ª£p ƒë·ªìng m·∫´u
        function initializeContracts() {
            addContract(true); // H·ª£p ƒë·ªìng 1
            document.getElementById('contract1Type').value = 'Gi·∫•y ƒëƒÉng k√Ω ki√™m h·ª£p ƒë·ªìng cho vay kh√¥ng TSBƒê, m·ªü & s·ª≠ d·ª•ng t√†i kho·∫£n thanh to√°n v√† d·ªãch v·ª• ng√¢n h√†ng ƒëi·ªán t·ª≠';
            document.getElementById('contract1Date').value = '08/12/2023';
            document.getElementById('contract1Amount').value = '30.000.000 ƒë·ªìng';
            document.getElementById('contract1Purpose').value = 'vay ti√™u d√πng';
            document.getElementById('contract1Term').value = '48 th√°ng';
            document.getElementById('contract1Interest').value = '23%/nƒÉm ƒë∆∞·ª£c c·ªë ƒë·ªãnh ƒë·∫øn k·ª≥ ƒëi·ªÅu ch·ªânh l√£i su·∫•t g·∫ßn nh·∫•t, sau ƒë√≥ ƒë·ªãnh k·ª≥ ƒëi·ªÅu ch·ªânh 03 th√°ng/01 l·∫ßn (+) bi√™n ƒë·ªô 18%/nƒÉm';
            document.getElementById('debtDate1').value = '20/11/2025';
            document.getElementById('principal1').value = '27.042.271 ƒë·ªìng';
            document.getElementById('interest1').value = '32.070.580 ƒë·ªìng';
            document.getElementById('total1').value = '59.112.851 ƒë·ªìng';
            
            addContract(true); // H·ª£p ƒë·ªìng 2
            document.getElementById('contract2Type').value = 'Gi·∫•y ƒë·ªÅ ngh·ªã ki√™m h·ª£p ƒë·ªìng c·∫•p h·∫°n m·ª©c t√≠n d·ª•ng th·∫ª, ph√°t h√†nh v√† s·ª≠ d·ª•ng th·∫ª t√≠n d·ª•ng d·ªãch v·ª• ng√¢n h√†ng ƒëi·ªán t·ª≠';
            document.getElementById('contract2Date').value = '05/12/2023';
            document.getElementById('contract2Amount').value = '11.000.000 ƒë·ªìng';
            document.getElementById('contract2Purpose').value = 'Vay ti√™u d√πng';
            document.getElementById('contract2Interest').value = '47.88%/nƒÉm';
            document.getElementById('debtDate2').value = '20/11/2025';
            document.getElementById('principal2').value = '10.542.307 ƒë·ªìng';
            document.getElementById('interest2').value = '26.564.426 ƒë·ªìng';
            document.getElementById('total2').value = '37.106.733 ƒë·ªìng';
        }
        
        // Th√™m h·ª£p ƒë·ªìng
        function addContract(isInitial = false) {
            if (!isInitial) {
                contractCount++;
            }
            const contractId = isInitial ? ++contractCount : contractCount;
            
            const contractDiv = document.createElement('div');
            contractDiv.className = 'contract-section';
            contractDiv.id = `contract${contractId}`;
            
            contractDiv.innerHTML = `
                <h4 style="color: #2c3e50; margin-bottom: 15px;">H·ª¢P ƒê·ªíNG VAY ${contractId}</h4>
                <div class="form-group">
                    <label>Lo·∫°i h·ª£p ƒë·ªìng:</label>
                    <input type="text" id="contract${contractId}Type">
                </div>
                <div class="form-group">
                    <label>Ng√†y k√Ω:</label>
                    <input type="text" id="contract${contractId}Date">
                </div>
                <div class="form-group">
                    <label>S·ªë ti·ªÅn vay/H·∫°n m·ª©c:</label>
                    <input type="text" id="contract${contractId}Amount">
                </div>
                <div class="form-group">
                    <label>M·ª•c ƒë√≠ch vay:</label>
                    <input type="text" id="contract${contractId}Purpose">
                </div>
                <div class="form-group">
                    <label>Th·ªùi h·∫°n vay:</label>
                    <input type="text" id="contract${contractId}Term">
                </div>
                <div class="form-group">
                    <label>L√£i su·∫•t:</label>
                    <input type="text" id="contract${contractId}Interest">
                </div>
                <div class="form-group">
                    <label>D∆∞ n·ª£ ƒë·∫øn ng√†y:</label>
                    <input type="text" id="debtDate${contractId}">
                </div>
                <table class="debt-table">
                    <tr>
                        <td style="width: 30%;">N·ª£ g·ªëc:</td>
                        <td style="width: 70%;"><input type="text" id="principal${contractId}"></td>
                    </tr>
                    <tr>
                        <td>N·ª£ l√£i:</td>
                        <td><input type="text" id="interest${contractId}"></td>
                    </tr>
                    <tr>
                        <td><strong>T·ªïng c·ªông:</strong></td>
                        <td><input type="text" id="total${contractId}"></td>
                    </tr>
                </table>
            `;
            
            document.getElementById('contractsContainer').appendChild(contractDiv);
        }
        
        function removeContract() {
            if (contractCount > 1) {
                const contractDiv = document.getElementById(`contract${contractCount}`);
                contractDiv.remove();
                contractCount--;
            }
        }
        
        // Qu·∫£n l√Ω kh√°ch h√†ng
        function initializeCustomers() {
            addCustomer(); // Kh√°ch h√†ng ƒë·∫ßu ti√™n
        }
        
        function addCustomer(customerData = null) {
            customerCount++;
            const customerId = customerCount;
            
            const customerDiv = document.createElement('div');
            customerDiv.className = 'customer-item';
            customerDiv.id = `customer${customerId}`;
            
            customerDiv.innerHTML = `
                <div class="customer-header">
                    <span>KH√ÅCH H√ÄNG ${customerId}</span>
                    <button class="remove-customer" onclick="removeSpecificCustomer(${customerId})">X√≥a</button>
                </div>
                <div class="form-group">
                    <label>H·ªç t√™n:</label>
                    <input type="text" id="customerName${customerId}" value="${customerData ? customerData.name : (customerId === 1 ? 'Phan Nh·∫≠t Linh' : '')}">
                </div>
                <div class="form-group">
                    <label>NƒÉm sinh:</label>
                    <input type="text" id="customerYear${customerId}" value="${customerData ? customerData.year : (customerId === 1 ? '1996' : '')}">
                </div>
                <div class="form-group">
                    <label>CMND/CCCD:</label>
                    <input type="text" id="customerId${customerId}" value="${customerData ? customerData.idNumber : (customerId === 1 ? '079096006806' : '')}">
                </div>
                <div class="form-group">
                    <label>Ng√†y c·∫•p:</label>
                    <input type="text" id="customerIdDate${customerId}" value="${customerData ? customerData.idDate : (customerId === 1 ? '22/11/2021' : '')}">
                </div>
                <div class="form-group">
                    <label>N∆°i c·∫•p:</label>
                    <input type="text" id="customerIdPlace${customerId}" value="${customerData ? customerData.idPlace : (customerId === 1 ? 'C·ª•c C·∫£nh s√°t v·ªÅ QLHC v√† TTXH' : '')}">
                </div>
                <div class="form-group">
                    <label>ƒê·ªãa ch·ªâ:</label>
                    <input type="text" id="customerAddress${customerId}" value="${customerData ? customerData.address : (customerId === 1 ? '158/5A ·∫•p Th·ªõi T√¢y 2, X√£ H√≥c M√¥n (X√£ T√¢n Hi·ªáp, Huy·ªán H√≥c M√¥n c≈©), Th√†nh ph·ªë H·ªì Ch√≠ Minh' : '')}">
                </div>
                <div class="form-group">
                    <label>S·ªë ƒëi·ªán tho·∫°i:</label>
                    <input type="text" id="customerPhone${customerId}" value="${customerData ? customerData.phone : (customerId === 1 ? '0901350113' : '')}">
                </div>
            `;
            
            document.getElementById('customersContainer').appendChild(customerDiv);
            updateCustomerCount();
        }
        
        function removeCustomer() {
            if (customerCount > 1) {
                const customerDiv = document.getElementById(`customer${customerCount}`);
                customerDiv.remove();
                customerCount--;
                updateCustomerCount();
            }
        }
        
        function removeSpecificCustomer(customerId) {
            if (customerCount > 1) {
                const customerDiv = document.getElementById(`customer${customerId}`);
                customerDiv.remove();
                // C·∫≠p nh·∫≠t l·∫°i ID cho c√°c kh√°ch h√†ng c√≤n l·∫°i
                for (let i = customerId + 1; i <= customerCount; i++) {
                    const currentCustomer = document.getElementById(`customer${i}`);
                    if (currentCustomer) {
                        currentCustomer.id = `customer${i-1}`;
                        currentCustomer.querySelector('.customer-header span').textContent = `KH√ÅCH H√ÄNG ${i-1}`;
                        currentCustomer.querySelector('.remove-customer').setAttribute('onclick', `removeSpecificCustomer(${i-1})`);
                        
                        // C·∫≠p nh·∫≠t ID cho c√°c input
                        const inputs = currentCustomer.querySelectorAll('input');
                        inputs[0].id = `customerName${i-1}`;
                        inputs[1].id = `customerYear${i-1}`;
                        inputs[2].id = `customerId${i-1}`;
                        inputs[3].id = `customerIdDate${i-1}`;
                        inputs[4].id = `customerIdPlace${i-1}`;
                        inputs[5].id = `customerAddress${i-1}`;
                        inputs[6].id = `customerPhone${i-1}`;
                    }
                }
                customerCount--;
                updateCustomerCount();
            }
        }
        
        function updateCustomerCount() {
            document.getElementById('customerCount').textContent = `S·ªë l∆∞·ª£ng kh√°ch h√†ng: ${customerCount}`;
        }
        
        // X·ª≠ l√Ω upload file
        function handleFileUpload(file) {
            if (!file) return;
            
            document.getElementById('fileName').textContent = file.name;
            document.getElementById('fileInfo').classList.remove('hidden');
            document.getElementById('progressBar').classList.remove('hidden');
            
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet, { header: 1 });
                    
                    uploadedData = jsonData.filter(row => row.length >= 6 && row[0]); // L·ªçc d√≤ng c√≥ d·ªØ li·ªáu
                    
                    document.getElementById('rowCount').textContent = uploadedData.length - 1; // Tr·ª´ d√≤ng ti√™u ƒë·ªÅ
                    document.getElementById('progress').style.width = '100%';
                    
                    setTimeout(() => {
                        document.getElementById('progressBar').classList.add('hidden');
                    }, 1000);
                    
                } catch (error) {
                    alert('L·ªói khi ƒë·ªçc file: ' + error.message);
                    document.getElementById('fileInfo').classList.add('hidden');
                    document.getElementById('progressBar').classList.add('hidden');
                }
            };
            
            reader.onerror = function() {
                alert('L·ªói khi ƒë·ªçc file');
                document.getElementById('fileInfo').classList.add('hidden');
                document.getElementById('progressBar').classList.add('hidden');
            };
            
            reader.readAsArrayBuffer(file);
        }
        
        function processUploadedData() {
            if (uploadedData.length === 0) {
                alert('Kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªÉ x·ª≠ l√Ω');
                return;
            }
            
            // X√≥a kh√°ch h√†ng c≈© (gi·ªØ l·∫°i kh√°ch h√†ng ƒë·∫ßu ti√™n)
            while (customerCount > 1) {
                removeCustomer();
            }
            
            let processedCount = 0;
            
            // X·ª≠ l√Ω t·ª´ng d√≤ng d·ªØ li·ªáu (b·ªè qua d√≤ng ti√™u ƒë·ªÅ)
            uploadedData.forEach((row, index) => {
                if (index === 0) return; // B·ªè qua d√≤ng ti√™u ƒë·ªÅ
                
                if (row.length >= 7) {
                    const customerData = {
                        name: row[0] || '',
                        year: row[1] || '',
                        idNumber: row[2] || '',
                        idDate: row[3] || '',
                        idPlace: row[4] || '',
                        address: row[5] || '',
                        phone: row[6] || ''
                    };
                    
                    addCustomer(customerData);
                    processedCount++;
                }
            });
            
            alert(`ƒê√£ th√™m ${processedCount} kh√°ch h√†ng t·ª´ file`);
            switchTab(1);
        }
        
        // X·ª≠ l√Ω d·ªØ li·ªáu d√°n
        function processPastedData() {
            const pasteData = document.getElementById('pasteData').value;
            const textData = document.getElementById('textData').value;
            
            if (!pasteData && !textData) {
                alert('Vui l√≤ng nh·∫≠p d·ªØ li·ªáu');
                return;
            }
            
            const dataToProcess = pasteData || textData;
            const lines = dataToProcess.split('\n').filter(line => line.trim());
            
            if (lines.length === 0) {
                alert('Kh√¥ng c√≥ d·ªØ li·ªáu h·ª£p l·ªá');
                return;
            }
            
            // X√≥a kh√°ch h√†ng c≈© (gi·ªØ l·∫°i kh√°ch h√†ng ƒë·∫ßu ti√™n)
            while (customerCount > 1) {
                removeCustomer();
            }
            
            let processedCount = 0;
            
            // Th√™m kh√°ch h√†ng m·ªõi t·ª´ d·ªØ li·ªáu d√°n
            lines.forEach((line, index) => {
                if (!line.trim()) return;
                
                // X√°c ƒë·ªãnh delimiter (tab ho·∫∑c |)
                const hasTab = line.includes('\t');
                const hasPipe = line.includes('|');
                const delimiter = hasTab ? '\t' : (hasPipe ? '|' : null);
                
                if (!delimiter) {
                    console.log('D√≤ng kh√¥ng c√≥ delimiter ph√π h·ª£p:', line);
                    return;
                }
                
                const columns = line.split(delimiter).map(col => col.trim());
                
                if (columns.length >= 7) {
                    const customerData = {
                        name: columns[0] || '',
                        year: columns[1] || '',
                        idNumber: columns[2] || '',
                        idDate: columns[3] || '',
                        idPlace: columns[4] || '',
                        address: columns[5] || '',
                        phone: columns[6] || ''
                    };
                    
                    addCustomer(customerData);
                    processedCount++;
                }
            });
            
            alert(`ƒê√£ th√™m ${processedCount} kh√°ch h√†ng t·ª´ d·ªØ li·ªáu`);
            switchTab(1);
        }
        
        // T·∫£i file m·∫´u
        function downloadTemplate() {
            const templateData = [
                ['H·ªç t√™n', 'NƒÉm sinh', 'CMND/CCCD', 'Ng√†y c·∫•p', 'N∆°i c·∫•p', 'ƒê·ªãa ch·ªâ', 'S·ªë ƒëi·ªán tho·∫°i'],
                ['Phan Nh·∫≠t Linh', '1996', '079096006806', '22/11/2021', 'C·ª•c C·∫£nh s√°t v·ªÅ QLHC v√† TTXH', '158/5A ·∫•p Th·ªõi T√¢y 2, X√£ H√≥c M√¥n (X√£ T√¢n Hi·ªáp, Huy·ªán H√≥c M√¥n c≈©), Th√†nh ph·ªë H·ªì Ch√≠ Minh', '0901350113'],
                ['Nguy·ªÖn VƒÉn A', '1985', '012345678901', '15/08/2020', 'C√¥ng an TP H√† N·ªôi', '123 ƒê∆∞·ªùng ABC, Qu·∫≠n 1, TP H·ªì Ch√≠ Minh', '0912345678']
            ];
            
            const ws = XLSX.utils.aoa_to_sheet(templateData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'KhachHang');
            XLSX.writeFile(wb, 'Mau_danh_sach_khach_hang.xlsx');
        }
        
        // T·∫°o ƒë∆°n
        function previewDocument() {
            if (customerCount === 0) {
                alert('Vui l√≤ng th√™m √≠t nh·∫•t m·ªôt kh√°ch h√†ng');
                return;
            }
            generateDocument(1); // Xem tr∆∞·ªõc kh√°ch h√†ng ƒë·∫ßu ti√™n
        }
        
        function generateDocument(customerIndex = 1) {
            // L·∫•y th√¥ng tin t·ª´ form
            const courtName = document.getElementById('courtName').value;
            const currentDate = document.getElementById('currentDate').value;
            const plaintiffName = document.getElementById('plaintiffName').value;
            const plaintiffAddress = document.getElementById('plaintiffAddress').value;
            const plaintiffContact = document.getElementById('plaintiffContact').value;
            const legalRepresentative = document.getElementById('legalRepresentative').value;
            const authorizedRepresentative = document.getElementById('authorizedRepresentative').value;
            const authorizationDoc = document.getElementById('authorizationDoc').value;
            
            const defendantName = document.getElementById(`customerName${customerIndex}`).value;
            const defendantYear = document.getElementById(`customerYear${customerIndex}`).value;
            const defendantID = document.getElementById(`customerId${customerIndex}`).value;
            const idIssueDate = document.getElementById(`customerIdDate${customerIndex}`).value;
            const idIssuePlace = document.getElementById(`customerIdPlace${customerIndex}`).value;
            const defendantAddress = document.getElementById(`customerAddress${customerIndex}`).value;
            const defendantPhone = document.getElementById(`customerPhone${customerIndex}`).value;
            
            const violationDate = document.getElementById('violationDate').value;
            const violationDescription = document.getElementById('violationDescription').value;
            
            // T·∫°o n·ªôi dung h·ª£p ƒë·ªìng
            let contractsContent = '';
            let totalPrincipal = 0;
            let totalInterest = 0;
            
            for (let i = 1; i <= contractCount; i++) {
                const contractType = document.getElementById(`contract${i}Type`).value;
                const contractDate = document.getElementById(`contract${i}Date`).value;
                const contractAmount = document.getElementById(`contract${i}Amount`).value;
                const contractPurpose = document.getElementById(`contract${i}Purpose`).value;
                const contractTerm = document.getElementById(`contract${i}Term`).value;
                const contractInterest = document.getElementById(`contract${i}Interest`).value;
                const debtDate = document.getElementById(`debtDate${i}`).value;
                const principal = document.getElementById(`principal${i}`).value;
                const interest = document.getElementById(`interest${i}`).value;
                const total = document.getElementById(`total${i}`).value;
                
                // T√≠nh t·ªïng n·ª£
                const principalValue = parseInt(principal.replace(/\./g, '')) || 0;
                const interestValue = parseInt(interest.replace(/\./g, '')) || 0;
                totalPrincipal += principalValue;
                totalInterest += interestValue;
                
                contractsContent += `
${i}.  <strong>${contractType}</strong> ng√†y ${contractDate}, c·ª• th·ªÉ:<br><br>

- ${contractAmount.includes('H·∫°n m·ª©c') ? 'H·∫°n m·ª©c t√≠n d·ª•ng:' : 'S·ªë ti·ªÅn cho vay:'} ${contractAmount}<br>
- M·ª•c ƒë√≠ch vay: ${contractPurpose}<br>
${contractTerm ? `- Th·ªùi h·∫°n vay: ${contractTerm}<br>` : ''}
- L√£i su·∫•t: ${contractInterest}<br><br>

D∆∞ n·ª£ th·ª±c t·∫ø t·∫°m t√≠nh ƒë·∫øn ng√†y ${debtDate} theo h·ª£p ƒë·ªìng cho vay tr√™n l√†:<br><br>

<table class="preview-table">
    <tr>
        <td style="width: 30%;">- N·ª£ g·ªëc:</td>
        <td style="width: 70%;">${principal}</td>
    </tr>
    <tr>
        <td>- N·ª£ l√£i:</td>
        <td>${interest}</td>
    </tr>
    <tr>
        <td><strong>T·ªïng c·ªông:</strong></td>
        <td><strong>${total}</strong></td>
    </tr>
</table>
<br>
`;
            }
            
            // Format s·ªë ti·ªÅn
            function formatCurrency(amount) {
                return amount.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".") + ' ƒë·ªìng';
            }
            
            const grandTotal = totalPrincipal + totalInterest;
            
            // T·∫°o n·ªôi dung ƒë∆°n
            const documentContent = `
<div style="text-align: center; font-style: italic; margin-bottom: 30px;">${currentDate}</div>

<div style="text-align: center; font-weight: bold; font-size: 16px; margin: 20px 0; text-transform: uppercase;">ƒê∆†N S·ª¨A ƒê·ªîI B·ªî SUNG ƒê∆†N KH·ªûI KI·ªÜN</div>

<div style="text-align: center; font-style: italic; margin-bottom: 30px;">(V/v √¥ng/b√† ${defendantName} vi ph·∫°m h·ª£p ƒë·ªìng t√≠n d·ª•ng)</div>

<div style="font-weight: bold; margin-bottom: 20px;">K√≠nh g·ª≠i: ${courtName}</div>

<div style="font-weight: bold; margin: 15px 0;">I. B√äN KH·ªûI KI·ªÜN: <strong>${plaintiffName}</strong>.</div>

<div style="padding-left: 40px;">
    - ƒê·ªãa ch·ªâ tr·ª• s·ªü: ${plaintiffAddress}.<br>
    - ƒê·ªãa ch·ªâ li√™n l·∫°c: ${plaintiffContact}.<br>
    - Ng∆∞·ªùi ƒë·∫°i di·ªán theo ph√°p lu·∫≠t: <strong>${legalRepresentative}</strong>.<br>
    - Ng∆∞·ªùi ƒë·∫°i di·ªán theo ·ªßy quy·ªÅn: <strong>${authorizedRepresentative}</strong>.<br>
    <br>
    <em>(${authorizationDoc}).</em>
</div>

<br>

<div style="font-weight: bold; margin: 15px 0;">II. B√äN B·ªä KI·ªÜN: √îNG/B√Ä ${defendantName} SINH NƒÇM: ${defendantYear}</div>

<div style="padding-left: 40px;">
    - CMND/CCCD s·ªë ${defendantID} do ${idIssuePlace} c·∫•p ng√†y ${idIssueDate}.<br>
    - ƒê·ªãa ch·ªâ: ${defendantAddress}.<br>
    - S·ªë ƒëi·ªán tho·∫°i: ${defendantPhone}
</div>

<br>

<div style="font-weight: bold; margin: 15px 0;">III. N·ªòI DUNG KH·ªûI KI·ªÜN:</div>

<div style="padding-left: 40px;">
    ${plaintiffName.split(' ')[0]} <em>(sau ƒë√¢y g·ªçi t·∫Øt l√† "VPBank")</em> v·ªõi √¥ng/b√† ${defendantName} ƒë√£ c√πng k√Ω k·∫øt c√°c H·ª£p ƒë·ªìng cho vay nh∆∞ sau:<br><br>
    
    ${contractsContent}
    
    T·ª´ ng√†y ${violationDate} √¥ng/b√† ${defendantName} ƒë√£ vi ph·∫°m nghƒ©a v·ª• thanh to√°n n·ª£ vay cho VPBank.<br><br>
    
    ${violationDescription.replace(/\n/g, '<br>')}
</div>

<br>

<div style="font-weight: bold; text-decoration: underline; margin: 20px 0;">[Y√äU C·∫¶U C·ª¶A NG∆Ø·ªúI KH·ªûI KI·ªÜN]</div>

<br>

<div style="padding-left: 40px;">
    K√≠nh ƒë·ªÅ ngh·ªã Qu√Ω T√≤a th·ª• l√Ω gi·∫£i quy·∫øt v·ª• √°n v√† xem x√©t ph√°n quy·∫øt:<br><br>
    
    1. Bu·ªôc √¥ng/b√† ${defendantName} ph·∫£i thanh to√°n cho VPBank m·ªôt l·∫ßn t·ªïng d∆∞ n·ª£ t·∫°m t√≠nh ƒë·∫øn ng√†y ${document.getElementById('debtDate1').value} l√†:<br><br>
    
    <table class="preview-table">
        <tr>
            <td style="width: 30%;">- N·ª£ g·ªëc:</td>
            <td style="width: 70%;">${formatCurrency(totalPrincipal)}</td>
        </tr>
        <tr>
            <td>- N·ª£ l√£i:</td>
            <td>${formatCurrency(totalInterest)}</td>
        </tr>
        <tr>
            <td><strong>T·ªïng c·ªông:</strong></td>
            <td><strong>${formatCurrency(grandTotal)}</strong></td>
        </tr>
    </table>
    <br>
    
    2. Y√™u c·∫ßu T√≤a √°n tuy√™n trong b·∫£n √°n ti·∫øp t·ª•c cho t√≠nh l√£i theo ƒë√∫ng th·ªèa thu·∫≠n trong c√°c H·ª£p ƒë·ªìng cho ƒë·∫øn khi √¥ng/b√† ${defendantName} th·ª±c t·∫ø thanh to√°n h·∫øt n·ª£ cho VPBank.<br><br>
    
    3. √îng/b√† ${defendantName} ph·∫£i ch·ªãu to√†n b·ªô √°n ph√≠ v√† c√°c chi ph√≠ li√™n quan (n·∫øu c√≥) do vi ph·∫°m nghƒ©a v·ª• thanh to√°n.<br><br>
    
    Nh·ªØng n·ªôi dung ƒë√£ tr√¨nh b√†y nh∆∞ tr√™n l√† ƒë√∫ng s·ª± th·∫≠t, k√≠nh tr√¨nh Qu√Ω T√≤a th·∫©m x√©t./
</div>

<br><br>

<div class="signature-section">
    <div><strong>NG∆Ø·ªúI KH·ªûI KI·ªÜN</strong></div>
    <br><br><br>
    <div><strong>${plaintiffName.split('(')[0].trim()}</strong></div>
    <br>
    <div><strong>NG∆Ø·ªúI ƒê·∫†I DI·ªÜN THEO ·ª¶Y QUY·ªÄN</strong></div>
    <br><br>
    <div><strong>${authorizedRepresentative.split('-')[0].trim()}</strong></div>
</div>
            `;
            
            document.getElementById('documentPreview').innerHTML = documentContent;
        }
        
        // T·∫°o t·∫•t c·∫£ ƒë∆°n
        function generateAllDocuments() {
            if (customerCount === 0) {
                alert('Vui l√≤ng th√™m √≠t nh·∫•t m·ªôt kh√°ch h√†ng');
                return;
            }
            
            alert(`ƒê√£ t·∫°o ${customerCount} ƒë∆°n kh·ªüi ki·ªán th√†nh c√¥ng!`);
            generateDocument(1); // Hi·ªÉn th·ªã ƒë∆°n ƒë·∫ßu ti√™n
        }
        
        // T·∫£i v·ªÅ
        function downloadAllDocuments() {
            if (customerCount === 0) {
                alert('Kh√¥ng c√≥ kh√°ch h√†ng n√†o ƒë·ªÉ t·∫£i v·ªÅ');
                return;
            }
            
            // T·∫°o t·ª´ng file ƒë∆°n
            for (let i = 1; i <= customerCount; i++) {
                const customerName = document.getElementById(`customerName${i}`).value;
                generateDocument(i);
                
                // T·∫°o blob v√† t·∫£i v·ªÅ
                const content = document.getElementById('documentPreview').innerHTML;
                const blob = new Blob([`
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <meta charset="UTF-8">
                        <style>
                            body { 
                                font-family: "Times New Roman", serif; 
                                line-height: 1.6;
                                padding: 40px;
                            }
                            .preview-table {
                                width: 100%;
                                border-collapse: collapse;
                                margin: 15px 0;
                            }
                            .preview-table td {
                                border: 1px solid #000;
                                padding: 8px 12px;
                            }
                        </style>
                    </head>
                    <body>
                        ${content}
                    </body>
                    </html>
                `], { type: 'text/html' });
                
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `Don_khoi_kien_${customerName.replace(/\s+/g, '_')}.doc`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }
            
            alert(`ƒê√£ t·∫£i v·ªÅ ${customerCount} file ƒë∆°n kh·ªüi ki·ªán`);
        }
        
        function downloadSummary() {
            let summary = 'B√ÅO C√ÅO T·ªîNG H·ª¢P ƒê∆†N KH·ªûI KI·ªÜN\n\n';
            summary += `Ng√†y t·∫°o: ${new Date().toLocaleDateString('vi-VN')}\n`;
            summary += `T·ªïng s·ªë kh√°ch h√†ng: ${customerCount}\n\n`;
            
            for (let i = 1; i <= customerCount; i++) {
                summary += `--- KH√ÅCH H√ÄNG ${i} ---\n`;
                summary += `H·ªç t√™n: ${document.getElementById(`customerName${i}`).value}\n`;
                summary += `NƒÉm sinh: ${document.getElementById(`customerYear${i}`).value}\n`;
                summary += `CMND/CCCD: ${document.getElementById(`customerId${i}`).value}\n`;
                summary += `Ng√†y c·∫•p: ${document.getElementById(`customerIdDate${i}`).value}\n`;
                summary += `N∆°i c·∫•p: ${document.getElementById(`customerIdPlace${i}`).value}\n`;
                summary += `ƒê·ªãa ch·ªâ: ${document.getElementById(`customerAddress${i}`).value}\n`;
                summary += `S·ªë ƒëi·ªán tho·∫°i: ${document.getElementById(`customerPhone${i}`).value}\n\n`;
            }
            
            const blob = new Blob([summary], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'Bao_cao_tong_hop.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        function printDocument() {
            const previewContent = document.getElementById('documentPreview').innerHTML;
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>In ƒê∆°n Kh·ªüi Ki·ªán</title>
                    <style>
                        body { 
                            font-family: "Times New Roman", serif; 
                            line-height: 1.6;
                            padding: 40px;
                        }
                        .preview-table {
                            width: 100%;
                            border-collapse: collapse;
                            margin: 15px 0;
                        }
                        .preview-table td {
                            border: 1px solid #000;
                            padding: 8px 12px;
                        }
                        @media print {
                            body { padding: 20px; }
                        }
                    </style>
                </head>
                <body>
                    ${previewContent}
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }
        
        function resetForm() {
            if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a t·∫•t c·∫£ d·ªØ li·ªáu?')) {
                location.reload();
            }
        }
        
        function setupEventListeners() {
            // K√©o th·∫£ file
            const uploadArea = document.getElementById('uploadArea');
            
            uploadArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                uploadArea.style.background = '#e8f4fc';
                uploadArea.style.borderColor = '#2980b9';
            });
            
            uploadArea.addEventListener('dragleave', function(e) {
                e.preventDefault();
                uploadArea.style.background = '#f8f9fa';
                uploadArea.style.borderColor = '#3498db';
            });
            
            uploadArea.addEventListener('drop', function(e) {
                e.preventDefault();
                uploadArea.style.background = '#f8f9fa';
                uploadArea.style.borderColor = '#3498db';
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFileUpload(files[0]);
                }
            });
        }
    </script>
</body>
</html>
